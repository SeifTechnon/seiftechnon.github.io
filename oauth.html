<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Seif Technon - YouTube OAuth</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: #f9f9f9;
        }
        button {
            padding: 12px 24px;
            font-size: 18px;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        code, p {
            direction: ltr;
        }
        img {
            border-radius: 50%;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <h2>تسجيل الدخول باستخدام حساب Google</h2>
    <button onclick="signIn()">تسجيل الدخول</button>

    <div id="channelInfo"></div>

    <script>
        const CLIENT_ID = "783665155303-24ca3sdd9c8qqj0gqu6372bbu6hqd4md.apps.googleusercontent.com"; // ← لا تنسَ تغييره
        const REDIRECT_URI = "https://seiftechnon.github.io/oauth.html";
        const SCOPE = "https://www.googleapis.com/auth/youtube.readonly";

        function signIn() {
            const authUrl = `https://accounts.google.com/o/oauth2/auth?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=${SCOPE}`;
            window.location.href = authUrl;
        }

        function handleRedirect() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const accessToken = params.get("access_token");

            if (accessToken) {
                localStorage.setItem("yt_token", accessToken);
                showAccessToken(accessToken);
            } else if (localStorage.getItem("yt_token")) {
                showAccessToken(localStorage.getItem("yt_token"));
            }
        }

        function showAccessToken(token) {
            document.body.innerHTML += `
                <p>تم تسجيل الدخول بنجاح! <br> تم حفظ access_token في localStorage</p>
                <code>${token}</code>
            `;
            getChannelInfo(token);
        }

        async function getChannelInfo(token) {
            try {
                const res = await fetch('https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&mine=true', {
                    headers: {
                        Authorization: `Bearer ${token}`
                    }
                });

                const data = await res.json();

                if (data.items && data.items.length > 0) {
                    const channel = data.items[0];
                    const name = channel.snippet.title;
                    const subs = channel.statistics.subscriberCount;
                    const icon = channel.snippet.thumbnails.default.url;

                    document.getElementById("channelInfo").innerHTML = `
                        <hr>
                        <h3>بيانات قناتك:</h3>
                        <img src="${icon}" width="80" height="80" alt="Channel Icon">
                        <p><b>${name}</b></p>
                        <p>المشتركين: ${subs}</p>
                    `;
                } else {
                    document.getElementById("channelInfo").innerText = "لم يتم العثور على قناة.";
                }
            } catch (err) {
                console.error(err);
                document.getElementById("channelInfo").innerText = "حدث خطأ أثناء جلب البيانات.";
            }
        }

        window.onload = handleRedirect;
    </script>
</body>
</html>
